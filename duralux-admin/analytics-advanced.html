<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Avançado - Duralux CRM</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Date Range Picker -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/duralux-admin.css">
    <link rel="stylesheet" href="assets/css/analytics.css">
    
    <style>
        .analytics-container {
            padding: 20px;
            background: #f8f9fa;
            min-height: 100vh;
        }
        
        .kpi-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: none;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            height: 100%;
        }
        
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .kpi-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin: 15px 0;
        }
        
        .kpi-label {
            font-size: 0.9rem;
            color: #6c757d;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .kpi-trend {
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .trend-up {
            color: #28a745 !important;
        }
        
        .trend-down {
            color: #dc3545 !important;
        }
        
        .kpi-progress {
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 15px;
        }
        
        .kpi-progress .progress-bar {
            height: 100%;
            transition: width 0.6s ease;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }
        
        .chart-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .chart-canvas {
            height: 300px !important;
        }
        
        .analytics-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .analytics-controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }
        
        .real-time-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: #28a745;
        }
        
        .real-time-dot {
            width: 8px;
            height: 8px;
            background: #28a745;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .table th {
            background: #667eea;
            color: white;
            border: none;
            font-weight: 600;
        }
        
        .btn-analytics {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-analytics:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            color: white;
        }
        
        .activities-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .activity-item {
            padding: 12px;
            border-left: 3px solid #667eea;
            background: #f8f9fa;
            margin-bottom: 8px;
            border-radius: 5px;
        }
        
        .activity-time {
            font-size: 0.8rem;
            color: #6c757d;
        }
    </style>
</head>

<body>
    <!-- Loading Overlay -->
    <div id="analyticsLoader" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <div class="loading-text">Carregando dados analíticos...</div>
        </div>
    </div>

    <div class="analytics-container" id="analyticsContainer">
        <!-- Header -->
        <div class="analytics-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1><i class="fas fa-chart-line me-3"></i>Analytics Avançado v7.0</h1>
                    <p class="mb-0">Dashboard executivo com análises preditivas e KPIs em tempo real</p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="real-time-indicator">
                        <div class="real-time-dot"></div>
                        Tempo Real Ativo
                    </div>
                    <div class="mt-2">
                        <small>Última atualização: <span id="lastRefreshTime">--:--</span></small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controles -->
        <div class="analytics-controls">
            <div class="row align-items-center">
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="analyticsDateRange" class="form-label fw-bold">Período de Análise</label>
                        <input type="text" class="form-control" id="analyticsDateRange" placeholder="Selecionar período">
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-check form-switch mt-4">
                        <input class="form-check-input" type="checkbox" id="realTimeToggle" checked>
                        <label class="form-check-label fw-bold" for="realTimeToggle">
                            Atualização em Tempo Real
                        </label>
                    </div>
                </div>
                <div class="col-md-5 text-end">
                    <button type="button" class="btn btn-analytics me-2" id="btnRefreshAnalytics">
                        <i class="fas fa-sync-alt me-2"></i>Atualizar Dados
                    </button>
                    <button type="button" class="btn btn-success" id="btnExportReport">
                        <i class="fas fa-file-pdf me-2"></i>Exportar Relatório
                    </button>
                </div>
            </div>
        </div>

        <!-- KPIs Grid -->
        <div class="row mb-4">
            <div class="col-lg-2 col-md-4 mb-3">
                <div class="kpi-card" id="totalLeads">
                    <div class="kpi-label">Total de Leads</div>
                    <div class="kpi-value">-</div>
                    <div class="kpi-trend">-</div>
                    <div class="kpi-progress">
                        <div class="progress-bar bg-primary" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-2 col-md-4 mb-3">
                <div class="kpi-card" id="conversionRate">
                    <div class="kpi-label">Taxa Conversão</div>
                    <div class="kpi-value">-</div>
                    <div class="kpi-trend">-</div>
                    <div class="kpi-progress">
                        <div class="progress-bar bg-success" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-2 col-md-4 mb-3">
                <div class="kpi-card" id="monthlyRevenue">
                    <div class="kpi-label">Receita Mensal</div>
                    <div class="kpi-value">-</div>
                    <div class="kpi-trend">-</div>
                    <div class="kpi-progress">
                        <div class="progress-bar bg-warning" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-2 col-md-4 mb-3">
                <div class="kpi-card" id="activeCustomers">
                    <div class="kpi-label">Clientes Ativos</div>
                    <div class="kpi-value">-</div>
                    <div class="kpi-trend">-</div>
                    <div class="kpi-progress">
                        <div class="progress-bar bg-info" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-2 col-md-4 mb-3">
                <div class="kpi-card" id="activeProjects">
                    <div class="kpi-label">Projetos Ativos</div>
                    <div class="kpi-value">-</div>
                    <div class="kpi-trend">-</div>
                    <div class="kpi-progress">
                        <div class="progress-bar bg-secondary" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-2 col-md-4 mb-3">
                <div class="kpi-card" id="avgDealSize">
                    <div class="kpi-label">Ticket Médio</div>
                    <div class="kpi-value">-</div>
                    <div class="kpi-trend">-</div>
                    <div class="kpi-progress">
                        <div class="progress-bar bg-dark" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gráficos Principais -->
        <div class="row">
            <div class="col-xl-8">
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-chart-line me-2"></i>Evolução de Leads por Dia
                    </div>
                    <canvas id="leadsChart" class="chart-canvas"></canvas>
                </div>
            </div>
            
            <div class="col-xl-4">
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-project-diagram me-2"></i>Status dos Projetos
                    </div>
                    <canvas id="projectsChart" class="chart-canvas"></canvas>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-xl-8">
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-dollar-sign me-2"></i>Receita Mensal e Previsões
                    </div>
                    <canvas id="revenueChart" class="chart-canvas"></canvas>
                </div>
            </div>
            
            <div class="col-xl-4">
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-filter me-2"></i>Funil de Conversão
                    </div>
                    <canvas id="conversionFunnelChart" class="chart-canvas"></canvas>
                </div>
            </div>
        </div>

        <!-- Tabelas e Atividades -->
        <div class="row">
            <div class="col-xl-8">
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-trophy me-2"></i>Top Clientes por Receita
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped mb-0" id="topCustomersTable">
                            <thead>
                                <tr>
                                    <th>Cliente</th>
                                    <th>Receita Total</th>
                                    <th>Projetos</th>
                                    <th>Última Atividade</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="5" class="text-center py-4">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Carregando...</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-4">
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-history me-2"></i>Atividades Recentes
                    </div>
                    <div class="activities-list" id="latestActivities">
                        <div class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Carregando...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Metrics -->
        <div class="row">
            <div class="col-12">
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-tachometer-alt me-2"></i>Métricas de Performance do Sistema
                    </div>
                    <canvas id="performanceChart" class="chart-canvas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-bottom" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="container-fluid">
            <div class="navbar-nav mx-auto">
                <a class="nav-link" href="index.html">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a class="nav-link" href="leads.html">
                    <i class="fas fa-users"></i> Leads
                </a>
                <a class="nav-link" href="projects.html">
                    <i class="fas fa-project-diagram"></i> Projetos
                </a>
                <a class="nav-link active" href="analytics-advanced.html">
                    <i class="fas fa-chart-line"></i> Analytics
                </a>
                <a class="nav-link" href="reports.html">
                    <i class="fas fa-file-alt"></i> Relatórios
                </a>
            </div>
        </div>
    </nav>

    <!-- Scripts -->
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Moment.js -->
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/locale/pt-br.js"></script>
    
    <!-- Date Range Picker -->
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    
    <!-- Advanced Analytics -->
    <script src="assets/js/duralux-advanced-analytics-v7.js"></script>
    
    <!-- Inicialização do Date Range Picker -->
    <script>
        $(document).ready(function() {
            moment.locale('pt-br');
            
            $('#analyticsDateRange').daterangepicker({
                startDate: moment().subtract(29, 'days'),
                endDate: moment(),
                locale: {
                    format: 'DD/MM/YYYY',
                    separator: ' - ',
                    applyLabel: 'Aplicar',
                    cancelLabel: 'Cancelar',
                    fromLabel: 'De',
                    toLabel: 'Até',
                    customRangeLabel: 'Personalizado',
                    weekLabel: 'S',
                    daysOfWeek: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'],
                    monthNames: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                               'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],
                    firstDay: 1
                },
                ranges: {
                   'Hoje': [moment(), moment()],
                   'Ontem': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                   'Últimos 7 Dias': [moment().subtract(6, 'days'), moment()],
                   'Últimos 30 Dias': [moment().subtract(29, 'days'), moment()],
                   'Este Mês': [moment().startOf('month'), moment().endOf('month')],
                   'Mês Passado': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                }
            });
        });
    </script>
</body>
</html>